<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Number Champ ‚Äì Kids Math Game (Age 9)</title>
<style>
  :root{
    --bg:#0f172a;        /* slate-900 */
    --card:#111827;      /* gray-900 */
    --muted:#cbd5e1;     /* slate-300 */
    --accent:#22c55e;    /* green-500 */
    --accent-2:#38bdf8;  /* sky-400 */
    --warning:#f59e0b;   /* amber-500 */
    --danger:#ef4444;    /* red-500 */
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 30% -10%, #1e293b 0%, #0b1224 60%, #050816 100%), var(--bg);
    color:#f8fafc;
    min-height:100svh;
    display:flex; align-items:center; justify-content:center;
    padding:16px;
  }
  .app{
    width:min(820px, 100%);
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border:1px solid rgba(255,255,255,0.08);
    border-radius:16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.45);
    overflow:hidden;
  }
  header{
    padding:18px 20px;
    display:flex; gap:12px; align-items:center; justify-content:space-between;
    background: rgba(17,24,39,0.7);
    border-bottom:1px solid rgba(255,255,255,0.08);
    backdrop-filter: blur(6px);
  }
  .title{
    font-weight:800; letter-spacing:0.2px; font-size:1.1rem;
    display:flex; align-items:center; gap:10px;
  }
  .title .badge{
    font-size:0.8rem; font-weight:700; color:#052e16;
    background:linear-gradient(180deg,#86efac,#22c55e);
    padding:2px 8px; border-radius:999px;
  }
  .settings{
    display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:flex-end;
  }
  .seg, .select, .btn{
    background:#0b1221; color:#e2e8f0;
    border:1px solid rgba(255,255,255,0.12);
    border-radius:10px;
    padding:10px 12px;
  }
  .seg{display:flex; gap:6px}
  .seg button{
    background:transparent; color:#cbd5e1; border:none; border-radius:8px; padding:8px 10px; font-weight:700;
  }
  .seg button.active{ background:#13213a; color:#86efac; border:1px solid rgba(34,197,94,0.4)}
  .select{display:flex; gap:8px; align-items:center}
  .select label{font-size:0.85rem; color:#a3b2c7}
  .select select{
    background:#0f1a31; color:#e2e8f0; border:1px solid rgba(255,255,255,0.12);
    border-radius:8px; padding:8px; font-weight:700;
  }
  main{ padding:20px; display:grid; grid-template-columns:1fr 320px; gap:16px}
  @media (max-width:880px){
    main{ grid-template-columns:1fr; }
  }
  .game{
    background:rgba(255,255,255,0.04);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:14px; padding:16px;
  }
  .status{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    margin-bottom:8px;
  }
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{
    background:#0c1427; border:1px solid rgba(255,255,255,0.08); color:#cde3ff;
    padding:6px 10px; border-radius:999px; font-weight:700; font-size:0.9rem;
  }
  .chip .good{ color:var(--accent);}
  .chip .bad{ color:var(--danger);}
  .progress{
    height:10px; background:#0b1221; border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,0.08);
  }
  .bar{ height:100%; width:0%; background:linear-gradient(90deg, #22c55e, #38bdf8); transition:width .25s ease}
  .card{
    margin-top:10px; background:linear-gradient(180deg, rgba(56,189,248,0.15), rgba(34,197,94,0.15));
    border:1px solid rgba(56,189,248,0.35); border-radius:14px; padding:18px;
  }
  .question{
    font-size: clamp(28px, 6vw, 44px); font-weight:900; text-align:center; letter-spacing:1px;
    text-shadow: 0 2px 0 rgba(0,0,0,0.35);
  }
  .options{
    margin-top:14px; display:grid; gap:12px;
    grid-template-columns: repeat(2, 1fr);
  }
  @media (max-width:460px){ .options{ grid-template-columns: 1fr; } }
  .opt{
    border:1px solid rgba(255,255,255,0.15);
    background: #0b1221;
    color:#e5f0ff;
    border-radius:12px; padding:14px;
    font-size: clamp(18px, 4.8vw, 24px); font-weight:800;
    text-align:center;
    touch-action: manipulation;
  }
  .opt.correct{ outline:3px solid var(--accent); background:#032911}
  .opt.wrong{ outline:3px solid var(--danger); background:#290308}
  .actions{ margin-top:10px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
  .btn{
    font-weight:800; letter-spacing:0.4px; cursor:pointer; padding:12px 16px; min-width:120px;
    background: linear-gradient(180deg, #0f1a31, #0b1221);
  }
  .btn.primary{ background:linear-gradient(180deg,#22c55e,#16a34a); color:#052e16; border:none }
  .btn.info{ background:linear-gradient(180deg,#38bdf8,#0ea5e9); color:#011826; border:none }
  .btn.warn{ background:linear-gradient(180deg,#f59e0b,#d97706); color:#3a1f00; border:none }
  .sidebar{
    background:rgba(255,255,255,0.04);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:14px; padding:16px;
    display:flex; flex-direction:column; gap:12px;
  }
  .board h3{ margin:0 0 8px 0}
  .board ol{ margin:0; padding:0 0 0 18px }
  .board li{ margin:4px 0; font-weight:700; color:#dbeafe}
  .small{ font-size:0.85rem; color:#abc0d6 }
  .ops{ display:flex; gap:8px; flex-wrap:wrap }
  .op-toggle{
    background:#0b1221; border:1px solid rgba(255,255,255,0.12); border-radius:10px; padding:8px 10px; display:flex; gap:8px; align-items:center;
  }
  .op-toggle input{ transform:scale(1.1) }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <span style="font-size:1.4rem">üßÆ</span>
        Number Champ
        <span class="badge">Age 9</span>
      </div>
      <div class="settings">
        <div class="seg" id="modeSeg" role="tablist" aria-label="Mode">
          <button class="active" data-mode="practice" aria-selected="true">Practice</button>
          <button data-mode="timed" aria-selected="false">Timed</button>
        </div>
        <div class="select">
          <label for="timerSel">Timer</label>
          <select id="timerSel" disabled>
            <option value="30">30s</option>
            <option value="60" selected>60s</option>
            <option value="120">120s</option>
          </select>
        </div>
        <div class="select">
          <label for="diffSel">Difficulty</label>
          <select id="diffSel">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
      </div>
    </header>

    <main>
      <section class="game" aria-live="polite">
        <div class="status">
          <div class="chips">
            <div class="chip">Score: <span id="score">0</span></div>
            <div class="chip">Streak: <span id="streak">0</span></div>
            <div class="chip">Correct: <span class="good" id="correct">0</span></div>
            <div class="chip">Wrong: <span class="bad" id="wrong">0</span></div>
          </div>
          <div style="min-width:180px; flex:1; max-width:320px; margin-left:auto">
            <div class="progress" title="Time left">
              <div class="bar" id="timeBar"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="question" id="question">Tap ‚ÄúStart‚Äù to play!</div>
          <div class="options" id="options" role="group" aria-label="Answer choices"></div>
        </div>

        <div class="actions">
          <button class="btn primary" id="startBtn">‚ñ∂ Start</button>
          <button class="btn info" id="skipBtn" disabled>Skip</button>
          <button class="btn warn" id="resetBtn">Reset</button>
        </div>
      </section>

      <aside class="sidebar">
        <div class="ops">
          <label class="op-toggle"><input type="checkbox" class="op" value="add" checked /> Add (+)</label>
          <label class="op-toggle"><input type="checkbox" class="op" value="sub" checked /> Subtract (‚àí)</label>
          <label class="op-toggle"><input type="checkbox" class="op" value="mul" checked /> Multiply (√ó)</label>
          <label class="op-toggle"><input type="checkbox" class="op" value="div" checked /> Divide (√∑)</label>
        </div>
        <div class="board">
          <h3>üèÜ Leaderboard (local)</h3>
          <ol id="board"></ol>
          <div class="small">Best scores are saved on this device.</div>
          <button class="btn" id="clearBoardBtn" style="margin-top:8px">Clear Leaderboard</button>
        </div>
        <div class="small">
          Tips: Choose Practice for calm learning, Timed for challenge. Streaks add bonus points. Division uses whole-number results only.
        </div>
      </aside>
    </main>
  </div>

<script>
  (function(){
    const qEl = document.getElementById('question');
    const optsEl = document.getElementById('options');
    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');
    const correctEl = document.getElementById('correct');
    const wrongEl = document.getElementById('wrong');
    const timeBar = document.getElementById('timeBar');
    const startBtn = document.getElementById('startBtn');
    const skipBtn = document.getElementById('skipBtn');
    const resetBtn = document.getElementById('resetBtn');
    const clearBoardBtn = document.getElementById('clearBoardBtn');
    const boardEl = document.getElementById('board');
    const diffSel = document.getElementById('diffSel');
    const timerSel = document.getElementById('timerSel');
    const modeSeg = document.getElementById('modeSeg');
    const opChecks = Array.from(document.querySelectorAll('.op'));

    let state = {
      running:false,
      practice:true,
      timeLimit:60,
      timeLeft:60,
      timerId:null,
      score:0, streak:0, correct:0, wrong:0,
      answer:null,
      currentQ:null
    };

    const randInt = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function rangesForDifficulty(){
      const d = diffSel.value;
      if(d==='easy')   return {small:10, big:12};
      if(d==='hard')   return {small:20, big:12}; // small used for +/- range, big for √ó/√∑ table
      return {small:15, big:12}; // medium
    }

    function genAddSub(op){
      const {small} = rangesForDifficulty();
      let a = randInt(0, small), b = randInt(0, small);
      if(op==='sub' && b>a){ [a,b]=[b,a]; }
      const ans = op==='add' ? a+b : a-b;
      const text = `${a} ${op==='add' ? '+' : '‚àí'} ${b} = ?`;
      return {text, ans};
    }

    function genMulDiv(op){
      const {big} = rangesForDifficulty();
      let a = randInt(1, big), b = randInt(1, big);
      if(op==='mul'){
        const ans = a*b;
        return {text:`${a} √ó ${b} = ?`, ans};
      } else {
        // ensure whole-number division: (a*b) √∑ a = b
        const prod = a*b;
        const ans = b;
        return {text:`${prod} √∑ ${a} = ?`, ans};
      }
    }

    function generateQuestion(){
      const enabledOps = opChecks.filter(c=>c.checked).map(c=>c.value);
      if(enabledOps.length===0){
        // force at least addition
        opChecks.find(c=>c.value==='add').checked = true;
        enabledOps.push('add');
      }
      const op = pick(enabledOps);
      let q;
      if(op==='add' || op==='sub') q = genAddSub(op);
      else q = genMulDiv(op);

      // Create believable choices
      const correct = q.ans;
      const choices = new Set([correct]);
      while(choices.size<4){
        let delta = pick([-3,-2,-1,1,2,3,4,-4,5,-5]);
        let fake = correct + delta;
        // keep positives and reasonable range
        if(fake<0) fake = Math.abs(fake)+randInt(0,3);
        choices.add(fake);
      }
      const shuffled = Array.from(choices).sort(()=>Math.random()-0.5);
      return {question:q.text, answer:correct, options:shuffled};
    }

    function renderQuestion(){
      const q = generateQuestion();
      state.currentQ = q;
      state.answer = q.answer;
      qEl.textContent = q.question;
      optsEl.innerHTML = '';
      q.options.forEach(val=>{
        const btn = document.createElement('button');
        btn.className = 'opt';
        btn.textContent = val;
        btn.setAttribute('aria-label', `Answer ${val}`);
        btn.addEventListener('click', ()=> choose(val, btn));
        optsEl.appendChild(btn);
      });
    }

    function updateHUD(){
      scoreEl.textContent = state.score;
      streakEl.textContent = state.streak;
      correctEl.textContent = state.correct;
      wrongEl.textContent = state.wrong;
    }

    function choose(val, btn){
      if(!state.running) return;
      const children = Array.from(optsEl.children);
      children.forEach(b=>b.disabled=true);
      if(val===state.answer){
        btn.classList.add('correct');
        state.correct++;
        state.streak++;
        let base = 10;
        let bonus = Math.max(0, state.streak-1)*2; // streak bonus
        state.score += base + bonus;
        beep(660, 80); setTimeout(()=>beep(880, 90), 90);
      } else {
        btn.classList.add('wrong');
        // reveal correct
        const correctBtn = children.find(b=> +b.textContent === state.answer);
        if(correctBtn) correctBtn.classList.add('correct');
        state.wrong++;
        state.streak = 0;
        beep(220, 150);
      }
      updateHUD();
      setTimeout(()=> {
        if(state.running) renderQuestion();
      }, 450);
    }

    function start(){
      state.running = true;
      skipBtn.disabled = false;
      startBtn.disabled = true;
      state.score=0; state.streak=0; state.correct=0; state.wrong=0;
      updateHUD();
      // timer
      if(state.practice){
        state.timeLeft = 1; // not used in practice
        timeBar.style.width = '0%';
      } else {
        state.timeLeft = state.timeLimit;
        tickTimer(true);
      }
      renderQuestion();
      qEl.focus();
    }

    function stop(endReason='Finished'){
      state.running = false;
      startBtn.disabled = false;
      skipBtn.disabled = true;
      if(state.timerId) clearInterval(state.timerId);
      // Save to leaderboard for timed mode
      if(!state.practice){
        saveScore({score:state.score, correct:state.correct, wrong:state.wrong, time:state.timeLimit, date:Date.now(), level:diffSel.value});
        loadBoard();
      }
      qEl.textContent = `${endReason}. Your score: ${state.score}`;
      optsEl.innerHTML = '';
    }

    function tickTimer(starting=false){
      if(state.timerId) clearInterval(state.timerId);
      const total = state.timeLimit;
      function draw(){
        const pct = Math.max(0, Math.min(100, (state.timeLeft/total)*100));
        timeBar.style.width = pct + '%';
        if(pct<=25) timeBar.style.background = `linear-gradient(90deg, var(--danger), var(--warning))`;
        else timeBar.style.background = `linear-gradient(90deg, #22c55e, #38bdf8)`;
      }
      if(starting) draw();
      state.timerId = setInterval(()=>{
        state.timeLeft--;
        draw();
        if(state.timeLeft<=0){
          clearInterval(state.timerId);
          stop('Time up');
        }
      }, 1000);
    }

    function skip(){
      if(!state.running) return;
      state.streak = 0;
      updateHUD();
      renderQuestion();
    }

    function reset(){
      if(state.timerId) clearInterval(state.timerId);
      state = {
        running:false, practice:state.practice, timeLimit:state.timeLimit, timeLeft:state.timeLimit,
        timerId:null, score:0, streak:0, correct:0, wrong:0, answer:null, currentQ:null
      };
      updateHUD();
      qEl.textContent = 'Tap ‚ÄúStart‚Äù to play!';
      optsEl.innerHTML = '';
      timeBar.style.width = '0%';
      startBtn.disabled = false;
      skipBtn.disabled = true;
    }

    function onModeChange(newMode){
      const isPractice = newMode==='practice';
      state.practice = isPractice;
      timerSel.disabled = isPractice;
      Array.from(modeSeg.querySelectorAll('button')).forEach(b=>{
        b.classList.toggle('active', b.dataset.mode===newMode);
        b.setAttribute('aria-selected', b.dataset.mode===newMode ? 'true':'false');
      });
      reset();
    }

    function onTimerChange(){
      state.timeLimit = parseInt(timerSel.value,10) || 60;
      state.timeLeft = state.timeLimit;
      timeBar.style.width = '0%';
    }

    function saveScore(entry){
      const key='number_champ_scores_v1';
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      arr.push(entry);
      arr.sort((a,b)=> b.score - a.score);
      localStorage.setItem(key, JSON.stringify(arr.slice(0,10)));
    }

    function loadBoard(){
      const key='number_champ_scores_v1';
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      boardEl.innerHTML = '';
      if(arr.length===0){
        boardEl.innerHTML = '<li>No scores yet ‚Äì try Timed mode!</li>';
        return;
      }
      arr.forEach((e,i)=>{
        const li = document.createElement('li');
        const date = new Date(e.date);
        const ds = date.toLocaleDateString([], {month:'short', day:'2-digit'});
        li.textContent = `${i+1}. ${e.score} pts ‚Äî ${e.correct}‚úì/${e.wrong}‚úó ‚Äî ${e.time}s ‚Äî ${e.level} ‚Äî ${ds}`;
        boardEl.appendChild(li);
      });
    }

    clearBoardBtn.addEventListener('click', ()=>{
      localStorage.removeItem('number_champ_scores_v1');
      loadBoard();
    });

    // small audio feedback using WebAudio (no external files)
    let audioCtx;
    function beep(freq=440, dur=120){
      try{
        audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.frequency.value = freq;
        o.type = 'sine';
        o.connect(g); g.connect(audioCtx.destination);
        g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.01);
        o.start();
        setTimeout(()=>{
          g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.05);
          setTimeout(()=>{ o.stop(); o.disconnect(); g.disconnect(); }, 60);
        }, dur);
      }catch(e){/* ignore */}
    }

    // Wire up UI
    startBtn.addEventListener('click', start);
    skipBtn.addEventListener('click', skip);
    resetBtn.addEventListener('click', reset);
    timerSel.addEventListener('change', onTimerChange);
    diffSel.addEventListener('change', reset);
    modeSeg.addEventListener('click', (e)=>{
      if(e.target.tagName==='BUTTON'){
        const mode = e.target.dataset.mode;
        onModeChange(mode);
      }
    });
    opChecks.forEach(c=> c.addEventListener('change', ()=> { if(!state.running) return; renderQuestion(); }));

    // keyboard support (optional)
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Enter') { if(!state.running) start(); else skip(); }
      if(['1','2','3','4'].includes(e.key)){
        const btn = optsEl.children[+e.key-1];
        if(btn) btn.click();
      }
    });

    loadBoard();
  })();
</script>
</body>
</html>
